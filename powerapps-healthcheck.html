<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Power Apps ヘルスチェック ダッシュボード</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --primary: #2563eb;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
    }

    * {
      box-sizing: border-box;
      font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }

    .tag {
      padding: 6px 10px;
      border-radius: 8px;
      background: #e0e7ff;
      color: #312e81;
      font-weight: 600;
      font-size: 12px;
    }

    .layout {
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.05);
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.28);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.32);
    }

    .btn:active {
      transform: translateY(0);
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 20px;
      background: #f1f5f9;
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--border);
    }

    .pill .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--muted);
    }

    .pill.success .dot { background: var(--success); }
    .pill.warning .dot { background: var(--warning); }
    .pill.danger .dot { background: var(--danger); }
    .pill.primary .dot { background: var(--primary); }

    .progress {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e2e8f0;
      overflow: hidden;
      margin: 10px 0 0;
    }

    .progress span {
      display: block;
      height: 100%;
      background: var(--primary);
      width: 0;
      transition: width 400ms ease;
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .summary .stat {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #f8fafc;
    }

    .stat label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .stat strong {
      font-size: 18px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }

    thead th {
      text-align: left;
      padding: 10px 8px;
      background: #f8fafc;
      border-bottom: 1px solid var(--border);
      color: var(--muted);
      font-weight: 600;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 120ms ease;
    }

    tbody tr:hover {
      background: #f8fafc;
    }

    td {
      padding: 10px 8px;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 12px;
      border: 1px solid var(--border);
      background: #f8fafc;
      color: var(--muted);
    }

    .status .dot { width: 10px; height: 10px; border-radius: 999px; }
    .status.ok { color: #166534; border-color: #bbf7d0; background: #ecfdf3; }
    .status.ok .dot { background: var(--success); }
    .status.running { color: #92400e; border-color: #fef08a; background: #fffbeb; }
    .status.running .dot { background: var(--warning); }
    .status.error { color: #991b1b; border-color: #fecdd3; background: #fff1f2; }
    .status.error .dot { background: var(--danger); }

    .table-card h3 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0;
      font-size: 16px;
    }

    .table-card h3 small {
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
    }

    .timeline {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      padding: 6px 8px;
      border-radius: 8px;
      background: #eef2ff;
      color: #312e81;
      font-weight: 600;
      font-size: 12px;
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 10px;
    }

    .actions .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .ghost-btn {
      background: #f8fafc;
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 700;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <div class="tag">Power Apps → Power Automate → デスクトップフロー</div>
      <h1>ヘルスチェック実行パネル</h1>
    </div>
    <button class="btn" id="runAllBtn" aria-label="ヘルスチェック全実行">
      ▶ 全実行
    </button>
  </header>

  <div class="layout">
    <section class="card">
      <h2>実行設定</h2>
      <p style="color: var(--muted); margin: 0 0 12px;">横画面で複数チェック項目の進捗をまとめて確認できます。Power Apps から Power Automate を経由し、デスクトップフローを直列で呼び出す想定のUIです。</p>
      <div class="actions">
        <div class="row">
          <button class="btn" id="runAllBtnSide" aria-label="全てのチェックを実行">▶ 全実行</button>
          <div style="display: flex; gap: 8px;">
            <select id="checkSelect" style="flex: 1; padding: 10px; border-radius: 10px; border: 1px solid var(--border);"></select>
            <button class="ghost-btn" id="runSelectedBtn" aria-label="選択したチェックを実行">▶ 選択実行</button>
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <button class="ghost-btn" id="stopBtn" aria-label="実行停止">■ 停止</button>
          <span style="font-size: 12px; color: var(--muted); font-weight: 700;">次のデスクトップフローから停止します</span>
        </div>
      </div>

      <div class="summary">
        <div class="stat">
          <label>対象チェック</label>
          <strong id="itemCount">0</strong>
        </div>
        <div class="stat">
          <label>実行済み</label>
          <strong id="doneCount">0</strong>
        </div>
        <div class="stat">
          <label>エラー</label>
          <strong id="errorCount">0</strong>
        </div>
        <div class="stat">
          <label>表示モード</label>
          <strong id="modeLabel">-</strong>
        </div>
      </div>

      <div style="margin-top: 16px;">
        <label style="font-size: 12px; color: var(--muted); font-weight: 700;">全体進捗</label>
        <div class="progress" aria-label="全体進捗">
          <span id="overallProgress"></span>
        </div>
      </div>

      <div class="legend">
        <span class="pill primary"><span class="dot"></span> 実行中</span>
        <span class="pill success"><span class="dot"></span> 成功</span>
        <span class="pill warning"><span class="dot"></span> 実行待ち/再試行</span>
        <span class="pill danger"><span class="dot"></span> 失敗</span>
      </div>

      <div style="margin-top: 16px;">
        <h2>フロー呼び出し順</h2>
        <div class="timeline">
          <span class="badge">① Power Apps ボタン</span>
          <span class="badge">② Power Automate (クラウド)</span>
          <span class="badge">③ Desktop フロー</span>
          <span class="badge">④ 監視結果 収集</span>
        </div>
      </div>
    </section>

    <section class="card table-card">
      <h3>チェック項目一覧 <small>全実行または個別実行後に対象を表示</small></h3>
      <table aria-label="チェック項目一覧">
        <thead>
          <tr>
            <th>チェック項目</th>
            <th style="width: 200px;">内容</th>
            <th style="width: 160px;">状態</th>
            <th style="width: 120px;">開始→終了</th>
          </tr>
        </thead>
        <tbody id="checkTable"></tbody>
      </table>
      <div id="placeholder" style="margin-top: 8px; color: var(--muted); font-weight: 600;">全実行か、個別実行後に表示します。</div>
    </section>
  </div>

  <script>
    const checks = [
      { id: "sample1", item: "チェック項目サンプル１", detail: "Web 応答確認", status: "running", start: "09:00", end: "-" },
      { id: "sample2", item: "チェック項目サンプル２", detail: "証明書期限チェック", status: "pending", start: "-", end: "-" },
      { id: "sample3", item: "チェック項目サンプル３", detail: "CPU / メモリ利用率", status: "ok", start: "08:55", end: "09:00" },
      { id: "sample4", item: "チェック項目サンプル４", detail: "API 応答コード監視", status: "ok", start: "08:55", end: "09:00" },
      { id: "sample5", item: "チェック項目サンプル５", detail: "バックアップ成否", status: "error", start: "08:50", end: "08:53" },
      { id: "sample6", item: "チェック項目サンプル６", detail: "可用性レプリカ遅延", status: "pending", start: "-", end: "-" },
      { id: "sample7", item: "チェック項目サンプル７", detail: "バッチ処理完了", status: "ok", start: "07:00", end: "07:10" },
      { id: "sample8", item: "チェック項目サンプル８", detail: "スケジュール確認", status: "pending", start: "-", end: "-" }
    ];

    const statusMap = {
      ok: { label: "成功", class: "ok" },
      running: { label: "実行中", class: "running" },
      error: { label: "失敗", class: "error" },
      pending: { label: "待機中", class: "" }
    };

    const table = document.getElementById("checkTable");
    const placeholder = document.getElementById("placeholder");
    const select = document.getElementById("checkSelect");
    const overallProgress = document.getElementById("overallProgress");
    const itemCount = document.getElementById("itemCount");
    const doneCount = document.getElementById("doneCount");
    const errorCount = document.getElementById("errorCount");
    const modeLabel = document.getElementById("modeLabel");

    let visibleChecks = [];
    let currentMode = "-";

    function populateDropdown() {
      select.innerHTML = "";
      checks.forEach(c => {
        const option = document.createElement("option");
        option.value = c.id;
        option.textContent = `${c.item} (${c.detail})`;
        select.appendChild(option);
      });
    }

    function render() {
      let done = 0;
      let errors = 0;

      table.innerHTML = "";
      visibleChecks.forEach(row => {
        if (row.status === "ok") done += 1;
        if (row.status === "error") errors += 1;

        const status = statusMap[row.status];
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><strong>${row.item}</strong></td>
          <td>${row.detail}</td>
          <td><span class="status ${status.class}"><span class="dot"></span>${status.label}</span></td>
          <td><div style="color: var(--muted); font-weight: 600;">${row.start} → ${row.end}</div></td>
        `;
        table.appendChild(tr);
      });

      placeholder.style.display = visibleChecks.length ? "none" : "block";

      const total = visibleChecks.length || 1;
      const progress = Math.round((done / total) * 100);
      overallProgress.style.width = progress + "%";

      itemCount.textContent = visibleChecks.length;
      doneCount.textContent = done;
      errorCount.textContent = errors;
      modeLabel.textContent = currentMode;
    }

    function setMode(mode, list) {
      currentMode = mode;
      visibleChecks = list;
      render();
    }

    document.getElementById("runAllBtn").addEventListener("click", () => {
      setMode("全実行", checks);
      alert("Power Automate 経由でデスクトップフローを全実行します (デモ)");
    });

    document.getElementById("runAllBtnSide").addEventListener("click", () => {
      setMode("全実行", checks);
      alert("Power Automate 経由でデスクトップフローを全実行します (デモ)");
    });

    document.getElementById("runSelectedBtn").addEventListener("click", () => {
      const targetId = select.value;
      const target = checks.find(c => c.id === targetId);
      if (!target) return;
      setMode("個別実行", [target]);
      alert(`${target.item} を Power Automate 経由で実行します (デモ)`);
    });

    document.getElementById("stopBtn").addEventListener("click", () => {
      alert("次のデスクトップフローから停止します (デモ)");
    });

    populateDropdown();
    render();
  </script>
</body>
</html>
