<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Power Apps ヘルスチェック ダッシュボード</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --primary: #2563eb;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
    }

    * {
      box-sizing: border-box;
      font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }

    .tag {
      padding: 6px 10px;
      border-radius: 8px;
      background: #e0e7ff;
      color: #312e81;
      font-weight: 600;
      font-size: 12px;
    }

    .layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.05);
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.28);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.32);
    }

    .btn:active {
      transform: translateY(0);
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 20px;
      background: #f1f5f9;
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--border);
    }

    .pill .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--muted);
    }

    .pill.success .dot { background: var(--success); }
    .pill.warning .dot { background: var(--warning); }
    .pill.danger .dot { background: var(--danger); }
    .pill.primary .dot { background: var(--primary); }

    .progress {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e2e8f0;
      overflow: hidden;
      margin: 10px 0 0;
    }

    .progress span {
      display: block;
      height: 100%;
      background: var(--primary);
      width: 0;
      transition: width 400ms ease;
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .summary .stat {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #f8fafc;
    }

    .stat label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .stat strong {
      font-size: 18px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }

    thead th {
      text-align: left;
      padding: 10px 8px;
      background: #f8fafc;
      border-bottom: 1px solid var(--border);
      color: var(--muted);
      font-weight: 600;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 120ms ease;
    }

    tbody tr:hover {
      background: #f8fafc;
    }

    td {
      padding: 10px 8px;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 12px;
      border: 1px solid var(--border);
      background: #f8fafc;
      color: var(--muted);
    }

    .status .dot { width: 10px; height: 10px; border-radius: 999px; }
    .status.ok { color: #166534; border-color: #bbf7d0; background: #ecfdf3; }
    .status.ok .dot { background: var(--success); }
    .status.running { color: #92400e; border-color: #fef08a; background: #fffbeb; }
    .status.running .dot { background: var(--warning); }
    .status.error { color: #991b1b; border-color: #fecdd3; background: #fff1f2; }
    .status.error .dot { background: var(--danger); }

    .table-card h3 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0;
      font-size: 16px;
    }

    .table-card h3 small {
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
    }

    .timeline {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      padding: 6px 8px;
      border-radius: 8px;
      background: #eef2ff;
      color: #312e81;
      font-weight: 600;
      font-size: 12px;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }

    .ghost-btn {
      background: #f8fafc;
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 700;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <div class="tag">Power Apps → Power Automate → デスクトップフロー</div>
      <h1>ヘルスチェック実行パネル</h1>
    </div>
    <button class="btn" id="runBtn" aria-label="ヘルスチェック実行">
      ▶ 実行
    </button>
  </header>

  <div class="layout">
    <section class="card">
      <h2>実行設定</h2>
      <p style="color: var(--muted); margin: 0 0 12px;">横画面で複数サーバーの状態をまとめて確認できます。Power Apps から Power Automate を経由し、デスクトップフローを直列で呼び出す想定のUIです。</p>
      <div class="actions">
        <select style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);">
          <option>平日日次チェック (全サーバー)</option>
          <option>週末フルチェック (冗長系含む)</option>
          <option>オンデマンド：Web/API 系</option>
        </select>
      </div>

      <div class="summary">
        <div class="stat">
          <label>対象サーバー</label>
          <strong id="serverCount">0</strong>
        </div>
        <div class="stat">
          <label>チェック項目</label>
          <strong id="itemCount">0</strong>
        </div>
        <div class="stat">
          <label>実行済み</label>
          <strong id="doneCount">0</strong>
        </div>
        <div class="stat">
          <label>エラー</label>
          <strong id="errorCount">0</strong>
        </div>
      </div>

      <div style="margin-top: 16px;">
        <label style="font-size: 12px; color: var(--muted); font-weight: 700;">全体進捗</label>
        <div class="progress" aria-label="全体進捗">
          <span id="overallProgress"></span>
        </div>
      </div>

      <div class="legend">
        <span class="pill primary"><span class="dot"></span> 実行中</span>
        <span class="pill success"><span class="dot"></span> 成功</span>
        <span class="pill warning"><span class="dot"></span> 実行待ち/再試行</span>
        <span class="pill danger"><span class="dot"></span> 失敗</span>
      </div>

      <div style="margin-top: 16px;">
        <h2>フロー呼び出し順</h2>
        <div class="timeline">
          <span class="badge">① Power Apps ボタン</span>
          <span class="badge">② Power Automate (クラウド)</span>
          <span class="badge">③ Desktop フロー</span>
          <span class="badge">④ 監視結果 収集</span>
        </div>
      </div>
    </section>

    <section class="card table-card">
      <h3>ヘルスチェック一覧 <small>同一画面で進捗をライブ確認</small></h3>
      <table aria-label="ヘルスチェック一覧">
        <thead>
          <tr>
            <th style="width: 160px;">サーバー</th>
            <th>チェック項目</th>
            <th style="width: 160px;">状態</th>
            <th style="width: 120px;">開始→終了</th>
          </tr>
        </thead>
        <tbody id="checkTable"></tbody>
      </table>
    </section>
  </div>

  <script>
    const checks = [
      { server: "WEB-01", item: "IIS 稼働 / 応答時間", status: "running", start: "09:00", end: "-" },
      { server: "WEB-01", item: "証明書期限 / 監視", status: "pending", start: "-", end: "-" },
      { server: "API-02", item: "CPU / メモリ利用率", status: "ok", start: "08:55", end: "09:00" },
      { server: "API-02", item: "エンドポイント応答コード", status: "ok", start: "08:55", end: "09:00" },
      { server: "DB-PRD", item: "バックアップ成否 / 最新世代", status: "error", start: "08:50", end: "08:53" },
      { server: "DB-PRD", item: "可用性グループレプリカ", status: "pending", start: "-", end: "-" },
      { server: "JOB-SVC", item: "夜間バッチ完了", status: "ok", start: "07:00", end: "07:10" },
      { server: "JOB-SVC", item: "スケジュール有効 / 次回予定", status: "pending", start: "-", end: "-" }
    ];

    const statusMap = {
      ok: { label: "成功", class: "ok" },
      running: { label: "実行中", class: "running" },
      error: { label: "失敗", class: "error" },
      pending: { label: "待機中", class: "" }
    };

    const table = document.getElementById("checkTable");
    const overallProgress = document.getElementById("overallProgress");
    const serverCount = document.getElementById("serverCount");
    const itemCount = document.getElementById("itemCount");
    const doneCount = document.getElementById("doneCount");
    const errorCount = document.getElementById("errorCount");

    function render() {
      const servers = new Set();
      let done = 0;
      let errors = 0;

      table.innerHTML = "";
      checks.forEach(row => {
        servers.add(row.server);
        if (row.status === "ok") done += 1;
        if (row.status === "error") errors += 1;

        const status = statusMap[row.status];
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><strong>${row.server}</strong></td>
          <td>${row.item}</td>
          <td><span class="status ${status.class}"><span class="dot"></span>${status.label}</span></td>
          <td><div style="color: var(--muted); font-weight: 600;">${row.start} → ${row.end}</div></td>
        `;
        table.appendChild(tr);
      });

      const total = checks.length;
      const progress = Math.round((done / total) * 100);
      overallProgress.style.width = progress + "%";

      serverCount.textContent = servers.size;
      itemCount.textContent = total;
      doneCount.textContent = done;
      errorCount.textContent = errors;
    }

    document.getElementById("runBtn").addEventListener("click", () => {
      alert("Power Automate 経由でデスクトップフローを起動します (デモ)");
    });

    render();
  </script>
</body>
</html>
